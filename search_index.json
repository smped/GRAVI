[["editing-yaml.html", "Chapter 4 YAML Configuration Files 4.1 The Main Configuration: config.yml 4.2 Colour Schemes: colours.yml 4.3 Additional Parameters: params.yml 4.4 HTML Settings: rmarkdown.yml", " Chapter 4 YAML Configuration Files All YAML files which ruin the workflow are located in the project_home/config directory. The standard YAML structure is used in all files with the primary objective being passing workflow parameters to the various steps of the workflow. There are four files which control various aspects: config.yml, colours.yml, params.yml and rmarkdown.yml 4.1 The Main Configuration: config.yml This file sets many of the primary parameters and is the file which will need editing for any new dataset. Many settings should remain unchanged as changing default locations of files may lead to unexpected instability in the workflow, whilst other setting should be changed, such as those which determine which comparisons to perform. This is the only file parsed directly by snakemake and subsequent rules, whilst all others are used to pass parameters to R environments. An example layout of config.yml might be: samples: file: &quot;config/samples.tsv&quot; paths: bam: &quot;data/aligned&quot; bigwig: &quot;data/bigwig&quot; macs2: &quot;data/macs2&quot; genome: build: &quot;GRCh37&quot; gencode: &quot;33&quot; external: rnaseq: &quot;data/external/results.tsv&quot; features: &quot;data/external/h3k27ac_features.gtf&quot; hic: &quot;data/external/encode_hic.bedpe&quot; coverage: H3K27Ac: control: &quot;data/external/H3K27Ac_control.bw&quot; treat: &quot;data/external/H3K27Ac_treat.bw&quot; comparisons: fc: 1.2 fdr: 0.05 paired: false filter_q: 0.6 contrasts: - [&quot;control&quot;, &quot;treat&quot;] ihw: &quot;regions&quot; peaks: macs2: gsize: &quot;hs&quot; fdr: 0.05 keep_duplicates: &quot;all&quot; qc: min_prop_peaks: 0.1 min_prop_reps: 0.3 4.1.1 Settings Which Don’t Need To Be Modified In general, the paths to key files don’t need to be changed and default configurations are well tested. Whilst varying these has been intermittently attempted successfully, unexpected instability may occur and as such, is discouraged. samples: (Default: “config/samples.tsv”) By default, the file which contains all sample-level information is defined as config/samples.tsv. In theory, this can be changed but this may adversely impact the pipeline. paths: bam: (Default: “data/aligned”) Alignments should be placed in data/aligned as advised in section 2.2, although this can be changed to data/bam or any other relative path as desired. Again, changes to the default layout may adversely affect the pipeline stability macs2: (Default: “data/macs2”) Output from macs2 callpeak will be placed in this directory, mirroring the input structure from data/aligned where each ChIP target (e.g. TF1, TF2) will have results written to separate directories. bigwig: (Default: “data/bigwig”) After running macs2 callpeak, bedGraph files will be converted to the more space efficient bigwig files. The directory structure from both data/aligned and data/macs2 will again be mirrored such that each ChIP target has all samples written to the same directory 4.1.2 Settings Which Should Be Modified genome: Specify the genome build used for alignments and for gene annotations. Build must match that used exactly for performing alignments. The gtf corresponding to the specified Gencode release will be downloaded as part of the workflow external: Provide paths to all optional data files here. Only files provided will be included in the workflow. rnaseq should be the results as output by limma::topTable() or similar. Gene IDs should match those provided in the Gencode GTF (e.g. Ensembl IDs) and these should be in a column names gene_id. Columns such as logFC and FDR will be searched for during the workflow using regular expressions to find the best match. Can be in csv or tsv format. Excel-specific (xls, xlsx) formats are not supported. features can be determined by any method, with common choices being relevant histone marks, or promoters, enhancers and super-enhancers determined by H3K27ac marks. Features should be non-overlapping with the field feature defining the different feature types. Must be provided in GTF format. hic HiC interactions must be provided as a bedpe file coverage Tracks provided in this argument will be added to all genomic plots showing binding peaks or differential binding. Multiple files provided within each YAML list element will be overlaid as a single track. There is no upper limit to the number of tracks, however more tracks generally detract from an informative figure. comparisons: These settings determine how the differential binding analysis is performed. fc (Default: 1.2) The setting of 1.2 indicates a 20% change in binding as the threshold below which we are not interested, or below which we consider binding changes to be inconsequential. This parameters is passed to limma::treat() (McCarthy and Smyth 2009) in all differential binding analyses. fdr (Default: 0.05) Windows with significance below this threshold are considered to provide supporting evidence of differential binding. paired (Default: false) If set to true the values in the optional column (e.g. replicate, passage etc.) are used to perform a paired analysis as described in the limma manual filter_q (Default: 0.6) Passed to extraChIPs::dualFilter(). When filtering (i.e. discarding) genomic sliding windows which are unlikely to contain true binding signal, determine thresholds which will retain this proportion of windows which overlap a peak identified by macs2 callpeak. contrasts: Define all contrasts for differential binding. Any ChIP target containing both treatment groups will be included for differential binding. Values must match those in the treat column of samples.tsv. Each differential binding analysis will be performed using the limma-trend method in the context of A vs B, such that complex models are not supported. Use new YAML list elements to define additional contrasts ihw (Default: “regions”) Options used to stratify p-values for Independent Hypothesis Weighting(Ignatiadis et al. 2016) of differential binding results. Can take values \"regions\", \"features\", \"targets\" or \"none\" \"regions\" P-values will be stratified by annotated genomic regions as determined in the initial steps of the workflow \"features\" P-values will be stratified by provided external features \"targets\" P-values will be stratified by the presence of a macs2 consensus peak using all other ChIP targets in combination \"none\" No Independent Hypothesis Weighting will be performed on the results from differential binding peaks: macs2 settings are passed to macs2 callpeak. Only the arguments gsize, fdr and keep_duplicates are accepted. Please see the macs2 manual for more detailed explanations. qc parameters are used for determining if samples are of a high enough quality, and how to determine consensus/oracle peaks for each target and treatment group. min_prop_peaks: (Default: 0.1) Samples within a treatment group must contain more than this proportion of peaks which overlap peaks from the “best” sample within the relevant treatment group, i.e. the sample with the most number of peaks identified by macs2 callpeak. This is an inclusive threshold which will only discard clearly poor samples, which themselves are more likely to occur in tissue/organoid than in cell-line derived data. min_prop_reps (Default: 0.3) When forming oracle peaks within each target and treatment group, peaks must be represented in at least this proportion of samples. This defaults to 0.3 which would equate to 1 of 3 samples, 2 of 4 samples etc. This value may need to be altered pending the results of a complete run after Quality Assessment has performed. 4.2 Colour Schemes: colours.yml Defines all plotting colour schemes for consistency throughout the entire workflow. Colours can be any standard colours able to be interpreted by R, such as 'blue' or '#0000FF'. Recommended YAML list elements are qc, regions, direction and treat. Any unspecified colours will be automatically assigned and will propagate through the workflow. As is standard across most programming languages, names are case-sensitive. An example file is given below: qc: pass: &quot;#0571B0&quot; fail: &quot;#CA0020&quot; direction: up: &quot;#CA0020&quot; down: &quot;#0571B0&quot; unchanged: &quot;#7F7F7F&quot; undetected: &quot;#E5E5E5&quot; regions: promoters: &#39;#FF3300&#39; upstream: &#39;#E1EE05&#39; exons: &#39;#7EDD57&#39; introns: &#39;#006600&#39; proximal: &#39;#000066&#39; distal: &#39;#551A8B&#39; treat: Input: &quot;#33333380&quot; control: &quot;#4D4D4D&quot; treat: &quot;#C53270&quot; features: promoter: &quot;#FF4500&quot; enhancer: &quot;#FFFF00&quot; super_enhancer: &quot;#FFC34D&quot; no_feature: &quot;#E5E5E5&quot; 4.3 Additional Parameters: params.yml Default settings for defining initial annotations and enrichment testing. In general, these will not need to be changed, but can be if required. Parameters for msigdb are passed to msigdbr(Dolgalev 2022) and fields should match this layout. Any categories passed to gs_cat will lead to all subcategories being used from that category. Specific sub-categories of larger databases can be passed using gs_subcat element. gene_regions: promoters: upstream: 1500 downstream: 500 upstream: 5000 intergenic: 10000 msigdb: gs_cat: &quot;H&quot; gs_subcat: - &quot;CP:KEGG&quot; - &quot;CP:REACTOME&quot; - &quot;CP:WIKIPATHWAYS&quot; - &quot;TFT:GTRD&quot; 4.4 HTML Settings: rmarkdown.yml The main workflow will produce a compiled set of HTML pages using rmarkdown::render_site()(Allaire et al. 2022). The two available fields to supply here are: knitr_opts which are passed to knitr::opts_chunk$set()(Xie 2022) at the beginning of every compiled Rmarkdown document, and rmarkdown_site which determines the layout and style of the final HTML report. All left elements of the navbar are determined automatically during the workflow and will be ignored if supplied here, whilst all other parameters are passed via the file _site.yaml which will be generated during the workflow. knitr_opts: echo: TRUE message: FALSE warning: FALSE dev: [&quot;png&quot;, &quot;pdf&quot;] fig.align: &quot;center&quot; fig.width: 10 fig.height: 8 rmarkdown_site: name: &quot;GRAVI: Gene Regulatory Analaysis&quot; output_dir: &quot;../docs&quot; navbar: title: &quot;GRAVI&quot; right: - icon: fa-github href: &quot;https://github.com/steveped/GRAVI&quot; output: html_document: toc: yes toc_float: yes code_folding: hide self_contained: false theme: sandstone highlight: textmate includes: after_body: footer.html References "]]
